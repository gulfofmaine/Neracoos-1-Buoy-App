"use strict";(self.webpackChunksrc=self.webpackChunksrc||[]).push([[2562],{"./src/Features/ERDDAP/hooks/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{yz:function(){return UseDataset},se:function(){return UsePlatforms}});var regeneratorRuntime=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),esm_exports=__webpack_require__("./node_modules/@sentry/core/esm/exports.js"),lib_useQuery=__webpack_require__("./node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),hookConfig_defaultQueryConfig={staleTime:3e5,cacheTime:9e5,refetchIntervalInBackground:!0},process=__webpack_require__("./node_modules/process/browser.js"),getPlatforms=function(){var _ref=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(){var url,result,json;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return url=process.env.REACT_APP_ERDDAP_SERVICE+"/api/platforms/",esm_exports.n_({category:"Buoy Barn",data:{url:url},message:"Loading platform GeoJSON"}),_context.next=4,fetch(url);case 4:return result=_context.sent,_context.next=7,result.json();case 7:return json=_context.sent,_context.abrupt("return",json);case 9:case"end":return _context.stop()}}),_callee)})));return function getPlatforms(){return _ref.apply(this,arguments)}}();var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),react=__webpack_require__("./node_modules/react/index.js"),time=__webpack_require__("./src/Shared/time.ts");var DatasetTypes=function(DatasetTypes){return DatasetTypes.grid="griddap",DatasetTypes.table="tabledap",DatasetTypes}({}),erddapServers_coastWatch="https://coastwatch.pfeg.noaa.gov/erddap",erddapServers_neracoos="http://www.neracoos.org/erddap",tabledap=(DatasetTypes.grid,DatasetTypes.grid,__webpack_require__("./src/Shared/erddap/tabledap.ts")),tabledap_process=__webpack_require__("./node_modules/process/browser.js");function urlBuilder(timeSeries,startTime){var _startTime;startTime=null!==(_startTime=startTime)&&void 0!==_startTime?_startTime:(0,time.bJ)();var constraints=(0,objectSpread2.Z)((0,objectSpread2.Z)({},timeSeries[0].constraints),{},{"time>=":startTime.toISOString()}),variables=timeSeries.map((function(ts){return ts.variable})),server=timeSeries[0].cors_proxy_url?tabledap_process.env.REACT_APP_ERDDAP_SERVICE+timeSeries[0].cors_proxy_url:timeSeries[0].server;return(0,tabledap.M5)(server,timeSeries[0].dataset,variables,constraints)}function useDataset(timeSeries,startTime){var _startTime2,_useState=(0,react.useState)(!0),_useState2=(0,slicedToArray.Z)(_useState,2),enabled=_useState2[0],setEnabled=_useState2[1];return startTime=null!==(_startTime2=startTime)&&void 0!==_startTime2?_startTime2:(0,time.bJ)(),(0,lib_useQuery.a)(["erddap-dataset",timeSeries,startTime],function getDataset(timeSeries,startTime){return(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(){var url,controller,timeoutId,result,json,resultTimeSeries;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return url=urlBuilder([timeSeries],startTime),esm_exports.n_({category:"ERDDAP TableDAP Dataset",data:{url:url},message:"Loading ERDDAP dataset"}),controller=new AbortController,timeoutId=setTimeout((function(){return controller.abort()}),5e3),_context.next=6,fetch(url,{signal:controller.signal});case 6:if((result=_context.sent).ok){_context.next=14;break}if(403!==result.status){_context.next=13;break}throw esm_exports.uT("Forbidden response"),new Error("Forbidden");case 13:esm_exports.uT("Unknown error with status code ".concat(result.status));case 14:return _context.next=16,result.json();case 16:return json=_context.sent,clearTimeout(timeoutId),resultTimeSeries=(0,tabledap.c8)(json,[timeSeries.variable]),_context.abrupt("return",resultTimeSeries[0]);case 20:case"end":return _context.stop()}}),_callee)})))}(timeSeries,startTime),(0,objectSpread2.Z)((0,objectSpread2.Z)({},hookConfig_defaultQueryConfig),{},{enabled:enabled,retry:function retry(failureCount,error){return"Forbidden"!==error.message||(setEnabled(!1),!1)}}))}var esm_Alert=__webpack_require__("./node_modules/reactstrap/esm/Alert.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),UsePlatforms=function UsePlatforms(_ref){var children=_ref.children,loading=_ref.loading,error=_ref.error,_usePlatforms=function usePlatforms(){return(0,lib_useQuery.a)(["buoybarn-platforms"],getPlatforms,hookConfig_defaultQueryConfig)}(),isLoading=_usePlatforms.isLoading,data=_usePlatforms.data;return isLoading?loading||(0,jsx_runtime.jsx)(esm_Alert.Z,{color:"primary",children:"Loading platform data"}):data?children({platforms:data.features}):error||(0,jsx_runtime.jsx)(esm_Alert.Z,{color:"warning",children:"Unable to load platforms"})},UsePlatform=function UsePlatform(_ref2){var _children=_ref2.children,loading=_ref2.loading,error=_ref2.error,platformId=_ref2.platformId;return _jsx(UsePlatforms,{loading:loading,error:error,children:function children(_ref3){var platform=_ref3.platforms.find((function(p){return p.id===platformId}));return platform?_children({platform:platform}):error||_jsxs(Alert,{children:["Unable to load platform ",platformId,"."]})}})};try{UsePlatforms.displayName="UsePlatforms",UsePlatforms.__docgenInfo={description:"Load platforms from Buoy Barn and then pass them to the child elements.",displayName:"UsePlatforms",props:{children:{defaultValue:null,description:"Pass platforms to child elements",name:"children",required:!0,type:{name:"(props: UsePlatformsRenderProps) => Element"}},loading:{defaultValue:null,description:"Override default loading alert",name:"loading",required:!1,type:{name:"Element"}},error:{defaultValue:null,description:"Override default error alert",name:"error",required:!1,type:{name:"Element"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/ERDDAP/hooks/BuoyBarnComponents.tsx#UsePlatforms"]={docgenInfo:UsePlatforms.__docgenInfo,name:"UsePlatforms",path:"src/Features/ERDDAP/hooks/BuoyBarnComponents.tsx#UsePlatforms"})}catch(__react_docgen_typescript_loader_error){}try{UsePlatform.displayName="UsePlatform",UsePlatform.__docgenInfo={description:"Load and display a specific platform",displayName:"UsePlatform",props:{children:{defaultValue:null,description:"Children elements to render selected platform information",name:"children",required:!0,type:{name:"(props: UsePlatformRenderProps) => Element"}},platformId:{defaultValue:null,description:"Platform to try to render",name:"platformId",required:!0,type:{name:"string"}},loading:{defaultValue:null,description:"Override default loading alert",name:"loading",required:!1,type:{name:"Element"}},error:{defaultValue:null,description:"Override default error alert",name:"error",required:!1,type:{name:"Element"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/ERDDAP/hooks/BuoyBarnComponents.tsx#UsePlatform"]={docgenInfo:UsePlatform.__docgenInfo,name:"UsePlatform",path:"src/Features/ERDDAP/hooks/BuoyBarnComponents.tsx#UsePlatform"})}catch(__react_docgen_typescript_loader_error){}var UseDatasets=function UseDatasets(_ref){var _startTime,children=_ref.children,timeSeries=_ref.timeSeries,startTime=_ref.startTime,fetchGroups=groupByServerDatasetConstraint(timeSeries);startTime=null!==(_startTime=startTime)&&void 0!==_startTime?_startTime:aWeekAgoRounded();var results=useQueries({queries:fetchGroups.map((function(group){return _objectSpread(_objectSpread({},defaultQueryConfig),{},{queryKey:["erddap-dataset",group.datasets,startTime],queryFn:function queryFn(){return getDatasetGroup(group,startTime)}})}))});if(void 0===results)return _jsx("h4",{children:"Results is not defined"});var _step,loadingGroups=results.filter((function(group){return group.isLoading})),errorGroups=results.filter((function(group){return group.error})),loadedGroups=results.filter((function(group){return group.data})),loadedDatasets=[],_iterator=_createForOfIteratorHelper(loadedGroups);try{for(_iterator.s();!(_step=_iterator.n()).done;){var group=_step.value;if(group.data)for(var _i=0,_arr=group.data;_i<_arr.length;_i++){var dataset=_arr[_i];loadedDatasets.push(dataset)}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return _jsxs(React.Fragment,{children:[loadingGroups.length>0?_jsx(Alert,{color:"primary",children:"Loading data"}):null,errorGroups.length>0?_jsx(Alert,{color:"warning",children:"Error loading datasets"}):null,loadedDatasets.length>0?children({datasets:loadedDatasets}):null]})},UseDataset=function UseDataset(_ref2){var children=_ref2.children,timeSeries=_ref2.timeSeries,startTime=_ref2.startTime,loading=_ref2.loading,error=_ref2.error,_useDataset=useDataset(timeSeries,startTime),isLoading=_useDataset.isLoading,data=_useDataset.data;return isLoading?loading||(0,jsx_runtime.jsxs)(esm_Alert.Z,{color:"primary",children:["Loading ",timeSeries.data_type.long_name," data"]}):data?children({dataset:data}):error||(0,jsx_runtime.jsxs)(esm_Alert.Z,{color:"warning",children:["Error loading ",timeSeries.data_type.long_name," data."," ",(0,jsx_runtime.jsx)("a",{href:(0,tabledap.PY)(timeSeries.server,timeSeries.dataset,[timeSeries.variable],timeSeries.constraints),children:"Try accessing dataset directly."})]})};try{UseDatasets.displayName="UseDatasets",UseDatasets.__docgenInfo={description:"Load and display multiple datasets for multiple time series",displayName:"UseDatasets",props:{timeSeries:{defaultValue:null,description:"",name:"timeSeries",required:!0,type:{name:"PlatformTimeSeries[]"}},startTime:{defaultValue:null,description:"",name:"startTime",required:!1,type:{name:"Date"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/ERDDAP/hooks/TableDAPComponents.tsx#UseDatasets"]={docgenInfo:UseDatasets.__docgenInfo,name:"UseDatasets",path:"src/Features/ERDDAP/hooks/TableDAPComponents.tsx#UseDatasets"})}catch(__react_docgen_typescript_loader_error){}try{UseDataset.displayName="UseDataset",UseDataset.__docgenInfo={description:"Load and display a specific dataset for a time series",displayName:"UseDataset",props:{loading:{defaultValue:null,description:"Override default loading alert",name:"loading",required:!1,type:{name:"Element"}},error:{defaultValue:null,description:"Override default error alert",name:"error",required:!1,type:{name:"Element"}},timeSeries:{defaultValue:null,description:"",name:"timeSeries",required:!0,type:{name:"PlatformTimeSeries"}},startTime:{defaultValue:null,description:"",name:"startTime",required:!1,type:{name:"Date"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/ERDDAP/hooks/TableDAPComponents.tsx#UseDataset"]={docgenInfo:UseDataset.__docgenInfo,name:"UseDataset",path:"src/Features/ERDDAP/hooks/TableDAPComponents.tsx#UseDataset"})}catch(__react_docgen_typescript_loader_error){}},"./src/Features/Units/UnitSelector/index.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{v:function(){return UnitSelectorBase}});var _usr_src_app_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_usr_src_app_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_usr_src_app_node_modules_babel_runtime_helpers_esm_inherits_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/inherits.js"),_usr_src_app_node_modules_babel_runtime_helpers_esm_createSuper_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createSuper.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),reactstrap__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/reactstrap/esm/ButtonGroup.js"),reactstrap__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/reactstrap/esm/Button.js"),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-redux/es/index.js"),redux__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/redux/es/redux.js"),_slice__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/Features/Units/slice.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/Features/Units/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js"),UnitSelectorBase=function(_React$Component){(0,_usr_src_app_node_modules_babel_runtime_helpers_esm_inherits_js__WEBPACK_IMPORTED_MODULE_6__.Z)(UnitSelectorBase,_React$Component);var _super=(0,_usr_src_app_node_modules_babel_runtime_helpers_esm_createSuper_js__WEBPACK_IMPORTED_MODULE_7__.Z)(UnitSelectorBase);function UnitSelectorBase(){var _this;(0,_usr_src_app_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_8__.Z)(this,UnitSelectorBase);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_super.call.apply(_super,[this].concat(args))).setSystem=function(system){return function(){_this.props.switchUnits(system)}},_this}return(0,_usr_src_app_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_9__.Z)(UnitSelectorBase,[{key:"render",value:function render(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(reactstrap__WEBPACK_IMPORTED_MODULE_10__.Z,{className:"unit-selector",children:[this.unitButton(_types__WEBPACK_IMPORTED_MODULE_3__.A.metric),this.unitButton(_types__WEBPACK_IMPORTED_MODULE_3__.A.english)]})}},{key:"unitButton",value:function unitButton(buttonSystem){var system=this.props.system;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(reactstrap__WEBPACK_IMPORTED_MODULE_11__.Z,{color:system===buttonSystem?"primary":"light",size:"sm",id:buttonSystem,active:system===buttonSystem,onClick:this.setSystem(buttonSystem),children:buttonSystem})}}]),UnitSelectorBase}(react__WEBPACK_IMPORTED_MODULE_0__.Component),UnitSelector=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.$j)((function mapStateToProps(_ref){return{system:_ref.unit.system}}),(function mapDispatchToProps(dispatch){return(0,redux__WEBPACK_IMPORTED_MODULE_5__.DE)({switchUnits:_slice__WEBPACK_IMPORTED_MODULE_2__.z},dispatch)}))(UnitSelectorBase);try{UnitSelectorBase.displayName="UnitSelectorBase",UnitSelectorBase.__docgenInfo={description:"",displayName:"UnitSelectorBase",props:{system:{defaultValue:null,description:"",name:"system",required:!0,type:{name:"enum",value:[{value:'"Metric"'},{value:'"English"'}]}},switchUnits:{defaultValue:null,description:"",name:"switchUnits",required:!0,type:{name:"(system: UnitSystem) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/Units/UnitSelector/index.tsx#UnitSelectorBase"]={docgenInfo:UnitSelectorBase.__docgenInfo,name:"UnitSelectorBase",path:"src/Features/Units/UnitSelector/index.tsx#UnitSelectorBase"})}catch(__react_docgen_typescript_loader_error){}try{UnitSelector.displayName="UnitSelector",UnitSelector.__docgenInfo={description:"",displayName:"UnitSelector",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/Units/UnitSelector/index.tsx#UnitSelector"]={docgenInfo:UnitSelector.__docgenInfo,name:"UnitSelector",path:"src/Features/Units/UnitSelector/index.tsx#UnitSelector"})}catch(__react_docgen_typescript_loader_error){}},"./src/Features/Units/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{cD:function(){return hooks_useUnitSystem}});__webpack_require__("./src/Features/Units/slice.ts"),__webpack_require__("./src/Features/Units/UnitSelector/index.tsx");var es=__webpack_require__("./node_modules/react-redux/es/index.js"),currentUnitSystem=function currentUnitSystem(state){return state.unit.system},hooks_useUnitSystem=function useUnitSystem(){return(0,es.v9)(currentUnitSystem)},UnitSystemConnector=function UnitSystemConnector(_ref){return(0,_ref.children)({unitSystem:useUnitSystem()})};try{UnitSystemConnector.displayName="UnitSystemConnector",UnitSystemConnector.__docgenInfo={description:"Connect to the current unit system from Redux store",displayName:"UnitSystemConnector",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Features/Units/Connector.tsx#UnitSystemConnector"]={docgenInfo:UnitSystemConnector.__docgenInfo,name:"UnitSystemConnector",path:"src/Features/Units/Connector.tsx#UnitSystemConnector"})}catch(__react_docgen_typescript_loader_error){}},"./src/Features/Units/slice.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{z:function(){return unitSwitch}});var _reduxjs_toolkit__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js"),_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Features/Units/types.ts"),unitSlice=(0,_reduxjs_toolkit__WEBPACK_IMPORTED_MODULE_1__.oM)({name:"unit",initialState:_types__WEBPACK_IMPORTED_MODULE_0__.E,reducers:{unitSwitch:function unitSwitch(state,action){var system=action.payload;state.system=system}}}),unitSwitch=unitSlice.actions.unitSwitch;unitSlice.reducer},"./src/Shared/erddap/tabledap.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{M5:function(){return tabledapUrl},PY:function(){return tabledapHtmlUrl},c8:function(){return resultToTimeseries},pD:function(){return tabledapProtocolUrl}});var _usr_src_app_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js"),_usr_src_app_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js");function tabledapProtocolUrl(server,dataset,protocol,variables,constraints){return"".concat(function baseTabledapUrl(server,dataset){var serverTrailing=server+(server.endsWith("/")?"":"/");return new URL("tabledap/".concat(dataset),serverTrailing).href}(server,dataset),".").concat(protocol,"?").concat(function variableString(variables){var vars=["time"].concat((0,_usr_src_app_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__.Z)(variables));return encodeURIComponent(vars.join(","))}(variables)).concat(function constraintsToString(constraints){var constraintStr="";for(var key in constraints)constraints.hasOwnProperty(key)&&(constraintStr+="number"==typeof constraints[key]?"&"+encodeURIComponent(key+constraints[key]):"&"+encodeURIComponent(key+'"'+constraints[key]+'"'));return constraintStr}(constraints))}function tabledapHtmlUrl(server,dataset,variables,constraints){return tabledapProtocolUrl(server,dataset,"html",variables,constraints)}function tabledapUrl(server,dataset,variables,constraints){return tabledapProtocolUrl(server,dataset,"json",variables,constraints)}function resultToTimeseries(result,variables){var _step,output=[],timeIndex=result.table.columnNames.indexOf("time"),_iterator=(0,_usr_src_app_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper_js__WEBPACK_IMPORTED_MODULE_1__.Z)(variables);try{var _loop=function _loop(){var variable=_step.value,varIndex=result.table.columnNames.indexOf(variable);output.push({name:variable,timeSeries:result.table.rows.filter((function(row){return null!==row[varIndex]})).map((function(row){return{reading:row[varIndex],time:new Date(row[timeIndex])}})).sort((function(a,b){return a.time.valueOf()-b.time.valueOf()})),unit:result.table.columnUnits[varIndex]})};for(_iterator.s();!(_step=_iterator.n()).done;)_loop()}catch(err){_iterator.e(err)}finally{_iterator.f()}return output}},"./src/Shared/time.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{SU:function(){return anHourAgoRounded},bJ:function(){return aWeekAgoRounded}});var HOUR=36e5,DAY=24*HOUR,WEEK=7*DAY;function roundDate(date){date.setUTCMinutes(5*Math.floor(date.getUTCMinutes()/5)),date.setSeconds(0),date.setMilliseconds(0)}function anHourAgoRounded(){var hourAgo=new Date(Date.now()-HOUR);return roundDate(hourAgo),hourAgo}function aWeekAgoRounded(){var weekAgo=new Date(Date.now()-WEEK);return roundDate(weekAgo),weekAgo}}}]);